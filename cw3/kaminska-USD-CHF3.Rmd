---
title: "Analiza kursu USD-CHF"
author: "Joanna Kamińska"
date: "29 marca 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
##  Analizowane dane
Dane są pobrane z HistData.com (https://www.histdata.com/), dotyczące kursu dolara amerykańskiego do franka szwajcarskiego. Analizowane dane pochodzą z okresu 01.01.2019 - 15.03.2019, z godzin: 8:00, 12:00, 16:00, 20:00.

## Wczytywanie danych
Dane zostały obrobione w Excelu.
```{r}
d<-read.csv2(file="kaminska-USD-CHF3.csv", header = TRUE, sep = ";", dec = ".")
d8<-d[d$godzina==80000,]
d12<-d[d$godzina==120000,]
d16<-d[d$godzina==160000,]
d20<-d[d$godzina==200000,]

head(d)
```

##Wykresy
Przedstawiam pojedyncze wykresy z chwili zamknięcia z godziny: 8:00, 12:00, 16:00, 20:00.
```{r echo = FALSE}
par(mfrow=c(2,2))
plot(1:nrow(d8), d8$zamkniecie, type = "l", xlab = "Dni", ylab = "Cena",col="red",main = "Kursy z godziny 8:00")
plot(1:nrow(d12), d12$zamkniecie, type = "l", xlab = "Dni", ylab = "Cena",col="green", main = "Kursy z godziny 12:00")
plot(1:nrow(d16), d16$zamkniecie, type = "l", xlab = "Dni", ylab = "Cena",col="blue", main = "Kursy z godziny 16:00")
plot(1:nrow(d20), d20$zamkniecie, type = "l", xlab = "Dni", ylab = "Cena",col="purple", main = "Kursy z godziny 20:00")
par(mfrow=c(1,1))
```
## Wykres

```{r echo = FALSE}
plot(1:nrow(d8), d8$zamkniecie, type = "l", xlab = "Dni", ylab = "Cena",col="red",main = "Porównanie kursów zamknięcia")
lines(d12$zamkniecie, col="green")
lines(d16$zamkniecie, col="blue")
lines(d20$zamkniecie, col="purple")
grid(NULL, NULL, col = "black")
legend("bottomright", c("godzina 8:00", "godzina 12:00", "godzina 16:00","godzina 20:00"), col =c("red","green","blue","purple"), lwd=2)
```
## Wykres porównujący kursy z godziny 8:00 i 20:00 w chwili otwarcia.
```{r echo = FALSE}
plot(1:nrow(d8), d8$otwarcie, type = "l", xlab = "Dni", ylab = "Cena",col="red",main = "Porównanie kursów z godziny 8:00 i 20:00")
x<-c(1:nrow(d8),53,0)
polygon(x,c(d8$otwarcie,0,0), col="pink")
polygon(x,c(d20$otwarcie,0,0), col="yellow")

```


## Zadanie 3 
```{r}
d12$t <- 1:length(d12$otwarcie)
```
## Model z trendem liniowym
Korzystając z regresji liniowej przedstawię dwa modele. Rozważmy tylko jedną zmienną - cenę otwarcia. Dane będą przedstawione w następujący sposób: jako zbiór uczący oraz zbiór przewidywany.
```{r}
p<-10
N<-length(d12$otwarcie)
zb_uczacy<-d12[1:(N-p), ] 
zb_przew<-d12[(N-p+1):N,]
```
Rozważmy model 1
```{r}
model1<-lm(otwarcie~t, d=zb_uczacy)
plot(zb_uczacy$t, zb_uczacy$otwarcie, main = "Predykcja na zbiorze uczącym", xlab="Dni", ylab="Otwarcie")
lines(zb_uczacy$t,predict(model1), col="red")
```
Podsumuwując:
```{r}
summary(model1)
```
Korzystając z modelu, zajmiemy się predykcją pozostałych wartości.
```{r}
b<-coef(model1)[1]
a<-coef(model1)[2]
plot(zb_przew$t, zb_przew$otwarcie, main = "Predykcja dla modelu 1", xlab="Dni", ylab="Kursy")
lines(zb_przew$t, a*zb_przew$t + b, col="purple")
```
## Błąd średniokwadratowy dla modelu 1
```{r}
blad1=mean((zb_przew$otwarcie-a*zb_przew$t + b)^2)
blad1
```
## Statystyka Theil'a dla modelu 1
```{r}
th1=sum((a*zb_przew$t + b-zb_przew$otwarcie)^2)/sum((zb_przew$otwarcie)^2)
th1
```
## Model 2
W modelu tym korzystać będziemy ze zbioru uczącego składającego się z 30 danych.
```{r}
u<-30
zb_uczacy2<-d12[(N-p-u+1):(N-p), ] 

zb_przew2<-d12[(N-p+1):N,]


model2<-lm(otwarcie~t, d=zb_uczacy2)
summary(model2)

```
```{r}
plot(zb_uczacy2$t, zb_uczacy2$otwarcie, main = "Predykcja na zbiorze uczącym", xlab="Dni", ylab="Otwarcie")
lines(zb_uczacy2$t,predict(model2), col="blue")
```
Korzystając z modelu, zajmiemy się predykcją pozostałych wartości.
```{r}
b2<-coef(model2)[1]
a2<-coef(model2)[2]
plot(zb_przew2$t, zb_przew2$otwarcie, main = "Predykcja dla modelu 2", xlab="Dni", ylab="Kursy")
lines(zb_przew2$t, a2*zb_przew2$t + b2, col="purple")
```
## Błąd średniokwadratowy dla modelu 2
```{r echo=FALSE}
blad2=mean((zb_przew2$otwarcie-a2*zb_przew2$t + b2)^2)
blad2
```
## Statystyka Theil'a dla modelu 2
```{r echo=FALSE}
th2=sum((a2*zb_przew2$t +b2-zb_przew2$otwarcie)^2)/sum((zb_przew2$otwarcie)^2)
th2
```

Podsumuwując:
Predykcja dla modelu 2 jest lepszą prognozą od modelu 1, ponieważ statystyka Theil'a jest mniejsza od 1, zatem wartości przewidywane są dokładniejsze.
