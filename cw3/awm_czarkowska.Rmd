---
title: "GPW-AWM"
author: "Marta Czarkowska"
date: "26 marca 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Naglowki

Airway Medix SA (AWM)
Pobieram notowania akcji spółki Airway Medix SA (AWM) ze strony stooq.pl w formacie csv 
z okresu 02.01.2019-22.03.2019. Notowania zawierają ceny: otwarcia,zamknięcia, najwyższe oraz najniższe. 
Pomijam kolumnę "wolumen" ponieważ nie będzie ona odgrywała roli w wykresach.

```{r}
library(readxl)
dane<- read_excel("dane_awm.xlsx", range="A1:E59")
```
  
Wyświetlam 6 pierwszych wierszy danych (do szybkiego wglądu)
```{r}
head(dane)
```
wyświetlam najważniejsze charakterystyki poszczególnych kolumn danych
```{r}
summary(dane)
```
Charakterystyki wyznaczone przez funkcję"summary" moża przedstawić w formie graficznej posługując się wykresem
pudełkowym (boxplot), dzięki któremu możemy łatwo porównać nasze dane. Na wykresie zobaczymy m.in: cenę minimalną
pierwszy kwartyl, medianę, trzeci kwartyl, maksimum które dany atrybut osiąga. Pokaże on również wartości odstające
```{r}
otwarcie<-dane$Otwarcie
zamkniecie<-dane$Zamkniecie
najwyzszy<-dane$Najwyzszy
najnizszy<-dane$Najnizszy
data<-dane$Data
boxplot(otwarcie,zamkniecie,najwyzszy,najnizszy, main="Wykres pudełkowy dla cen 
AWM",col=c("yellowgreen","skyblue3","plum3","orange"),names=c("Otwarcie","Zamknięcie","Najwyższy","Najniszy"))
```
Rysuję wykresy liniowe dla każdego z atrybutów 

```{r}
par(mfrow = c(2, 2),pty="m",las = 2)
matplot(otwarcie,type='l',col="blue",xlab = "Data",xaxt = "n")
title(main = list("Wykres liniowy dla cen Otwarcia" , font = 7, cex = 1.5))
axis(1, at = data, labels = levels(data),cex.axis = 0.6)
grid(NULL, NULL, col = "grey")
matplot(zamkniecie,type="l",col="red",xlab="Data",xaxt = "n",ylab="Cena AWM")
title(main = list("Wykres liniowy dla cen Zamknięcia" , font = 7, cex = 1.5))
axis(1, at = data, labels = levels(data),cex.axis = 0.6)
grid(NULL, NULL, col = "grey")
matplot(najnizszy,type='l',col="violet", xlab = "Data", xaxt = "n",ylab="Cena AWM")
title(main = list("Wykres liniowy dla cen Najniższych" , font = 7, cex = 1.5))
axis(1, at = data, labels = levels(data),cex.axis = 0.6)
grid(NULL, NULL, col = "grey")
matplot(najwyzszy,type='l',col="green",xlab = "Data",xaxt = "n",main="Wykres liniowy dla cen Najwyzszych",ylab="Cena AWM")
title(main="Wykres liniowy dla cen Najwyższych", font=7, cex=1.5)
axis(1, at = data, labels = levels(data),cex.axis = 0.6)
grid(NULL, NULL, col = "grey")
```
w celu ułatwienia porównania wszytskich czterech wykresów liniowych można stworzyć wykres zbiorczy
```{r}
par(pty="m",las = 2)
matplot(otwarcie,type="l",col="yellowgreen", ylim=c(0.62  , 0.835),xlab="data", ylab="Ceny AWM",xaxt = "n")
title(main = list("wykres zbiorczy" , font = 7, cex = 1.5))
axis(1, at = data, labels = levels(data),cex.axis = 0.6)
lines(zamkniecie,col="skyblue3")
lines(najnizszy,col="orange")
lines(najwyzszy,col="plum3")
legend("topright", legend=c("Otwarcie", "Zamknięcie ","Najniższe","Najwyższe
                           "),
       col=c("yellowgreen", "skyblue3","orange","plum3"), lwd=1)
grid(NULL, NULL, col = "grey")
```

#zadanie 3 predykcja

Pierwszym krokiem jest wczytanie danych z poprzedniego zadania. Do wykonania zadania wybrałam kolumnę z cenami otwarcia ze spółki AWM za okres 02.02.2019-22.03.2019

```{r}
library(readxl)
dane <- read_excel("dane_awm.xlsx", range = "a1:b59")


otwarcie<-dane$Otwarcie
dzien<-as.numeric(1:length(dane$Data))
d<-data.frame(cbind(dzien,otwarcie))
head(d)
```

Następnie dzielimy nasze dane na dwa zbiory: testowy i uczący. Zbiór uczcący będzie z okresu 02-01-2019 - 05-03-2019, a testowy 06-03-2019 do 22-03-2019
```{r}
zb_uczacy<-data.frame(dzien=dzien[1:44],otwarcie=otwarcie[1:44])
zb_testowy<-data.frame(dzien=dzien[45:nrow(dane)],otwarcie=otwarcie[45:nrow(dane)])
class(zb_testowy)
```

Rozważmy model liniowy dla całych przeszłych danych, za pomocą funkcji "plot" możemy zobaczyć jak wygląda dopasowanie modelu do danych.Współczynnik R^2 opisuje jakość dopasowania.
```{r}
model<-lm(otwarcie~dzien,data=zb_uczacy)
summary(model)
plot(d$otwarcie,type="l",pch=20, cex=1,xlab = "Data", ylab = "Cena otwarcia akcji")
abline(model, col="blue")
axis(1,at = dane$Data, labels = levels(dane$Data
                                       ))
abline(v=44, lty=2)
text(mean(dzien),mean(otwarcie), round(summary(model)$r.squared,5),pos=4)
```

Zajmiemy się teraz predykcją dla cen akcji spółki AWM od 06-03-2019 (zbior testowy). Możemy także zobaczyć jego wykres
```{r}
prognoza<-predict(model, data = zb_testowy)
prognoza
plot(zb_testowy$otwarcie,xlab = "Data",ylab = "Cena otwarcia akcji", main="Model z trendem liniowym dla wszytskich przeszłych danych", type="l")
lines(prognoza, col="blue")
```


Przejdźmy teraz do modelu z trendem liniowym, który będzie korzystał ze stałej ilości "n"próbek (danych) poprzedzających daną chwilę. Wyznaczymy również jego wykres. W tym przypadku niech n=20
```{r}
liczba_dni<-nrow(zb_uczacy)

model_n<-lm(otwarcie~dzien,data=zb_uczacy[(liczba_dni+1-20):liczba_dni,])
summary(model_n)
plot( otwarcie,type="l",xlab = "Data", ylab = "Cena otwarcia akcji")
abline(model_n, col="purple")
text(mean(dzien),mean(otwarcie), round(summary(model_n)$r.squared,5),pos=4)
abline(v=44,lty=2)
```
prognoza dla powyższego modelu dana jest wzorem:

```{r}
prognoza2=predict(model_n,newdata=zb_testowy)
prognoza2
```

KOWALSKI: Poniższe wykresy są niepoprawne. I wymagałyby dalszej poprawy. Zostaną jednak z uwagi na termin wyjątkowo włączone do repozytorium.

Zilustrujmy te wartości na wykresie:
```{r}
prognoza2=predict(model_n,newdata=zb_testowy)
prognoza2
plot(zb_testowy$otwarcie,
      xlab = "Data", ylab="Ceny otwarcia spółki AWM", type="l", main="Prognoza ceny Otwarcia",ylim=c(0.62  , 0.765))
lines(prognoza2, col="blue", type="l")
```

# Błąd średniokwadratowy i statystyka Theil'a

Obliczymy teraz błąd średniokwadratowy oraz statystykę Theil'a dla pierwszego modelu

```{r}
b_sredkw<-mean(((prognoza - zb_testowy$otwarcie)^2))
b_sredkw
stat_Th<-sum(((prognoza-zb_testowy$otwarcie)^2))/sum((zb_testowy$otwarcie^2))
stat_Th
```

Dla drugiego modelu także wyznaczamy powyższe statystyki

```{r}
b_sredkw<-mean(((prognoza2 - zb_testowy$otwarcie)^2))
b_sredkw
stat_Th<-sum(((prognoza2-zb_testowy$otwarcie)^2))/sum((zb_testowy$otwarcie^2))
stat_Th
```
